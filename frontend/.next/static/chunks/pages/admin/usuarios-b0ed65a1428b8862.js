(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[875],{2811:function(e,r,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/usuarios",function(){return o(5700)}])},5376:function(e,r,o){"use strict";o.d(r,{Z:function(){return t}});var i=o(5893),a=o(1163),l=o(7294);function t(){let[e,r]=(0,l.useState)(null),o=(0,a.useRouter)();if((0,l.useEffect)(()=>{let e=localStorage.getItem("user");e?r(JSON.parse(e)):o.push("/login")},[o]),!e)return null;let t=[];return"admin"===e.role?t.push({label:"Dashboard",href:"/dashboard"},{label:"Gesti\xf3n de Usuarios",href:"/admin/usuarios"},{label:"Gesti\xf3n de Empresas",href:"/admin/empresas"},{label:"Barridos",href:"/admin/barridos"},{label:"Matrices de Riesgo",href:"/admin/matrices"}):"consultor"===e.role?t.push({label:"Dashboard",href:"/dashboard"},{label:"Empresas",href:"/consultor/empresas"},{label:"Alertas",href:"/consultor/alertas"},{label:"Reportes",href:"/consultor/reportes"}):"cliente"===e.role&&t.push({label:"Dashboard",href:"/dashboard"},{label:"Mis Clientes",href:"/cliente/clientes"},{label:"Transacciones",href:"/cliente/transacciones"},{label:"Reportes",href:"/cliente/reportes"}),(0,i.jsxs)("nav",{style:{backgroundColor:"#1e40af",padding:"1rem",color:"white",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)("div",{children:(0,i.jsx)("h2",{style:{margin:0,fontSize:"1.2rem"},children:"admin"===e.role?"Consola Administrativa":"consultor"===e.role?"Panel Consultor":"Portal Cliente"})}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{marginBottom:"0.5rem",fontSize:"0.9rem"},children:[e.email," (",e.role,")"]}),(0,i.jsxs)("div",{style:{display:"flex",gap:"1rem"},children:[t.map(e=>(0,i.jsx)("button",{onClick:()=>o.push(e.href),style:{color:"white",background:"none",border:"none",cursor:"pointer",textDecoration:o.pathname===e.href?"underline":"none"},children:e.label},e.href)),(0,i.jsx)("button",{onClick:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),o.push("/login")},style:{color:"#f87171",background:"none",border:"none",cursor:"pointer"},children:"Cerrar Sesi\xf3n"})]})]})]})}},5700:function(e,r,o){"use strict";o.r(r),o.d(r,{default:function(){return s}});var i=o(5893),a=o(7294),l=o(1163),t=o(7066),n=o(5376);function s(){let[e,r]=(0,a.useState)([]),[o,s]=(0,a.useState)([]),[d,c]=(0,a.useState)(""),[m,u]=(0,a.useState)(!1),[p,h]=(0,a.useState)(!1),[b,x]=(0,a.useState)(null),[g,j]=(0,a.useState)({email:"",password:"",nombre_completo:"",rol:"cliente",empresa_id:""}),y=(0,l.useRouter)();(0,a.useEffect)(()=>{let e=localStorage.getItem("token"),o=JSON.parse(localStorage.getItem("user")||"{}");if(!e||"admin"!==o.role){y.push("/login");return}(async()=>{try{let[o,i]=await Promise.all([t.Z.get("/api/admin/usuarios",{headers:{Authorization:"Bearer ".concat(e)}}),t.Z.get("/api/admin/empresas",{headers:{Authorization:"Bearer ".concat(e)}})]);r(o.data.usuarios),s(i.data.empresas)}catch(e){var o,i;c((null===(i=e.response)||void 0===i?void 0:null===(o=i.data)||void 0===o?void 0:o.error)||"Error al cargar datos")}})()},[y]);let f=e=>{let{name:r,value:o}=e.target;j(e=>({...e,[r]:o}))},v=e=>{var r;x(e.id),j({email:e.email,password:"",nombre_completo:e.nombre_completo,rol:e.rol,empresa_id:(null===(r=e.empresa_id)||void 0===r?void 0:r.toString())||""}),h(!0)},C=async e=>{if(!confirm("\xbfEst\xe1 seguro de desactivar este usuario?"))return;let o=localStorage.getItem("token");try{await t.Z.put("/api/admin/usuarios/".concat(e),{activo:!1},{headers:{Authorization:"Bearer ".concat(o)}}),r(r=>r.map(r=>r.id===e?{...r,activo:!1}:r))}catch(e){var i,a;c((null===(a=e.response)||void 0===a?void 0:null===(i=a.data)||void 0===i?void 0:i.error)||"Error al desactivar usuario")}},w=async e=>{e.preventDefault();let o=localStorage.getItem("token");u(!0),c("");try{if(b){let e={email:g.email,nombre_completo:g.nombre_completo,rol:g.rol};"cliente"===g.rol&&(e.empresa_id=g.empresa_id?Number(g.empresa_id):null),await t.Z.put("/api/admin/usuarios/".concat(b),e,{headers:{Authorization:"Bearer ".concat(o)}})}else{let e={...g,empresa_id:"cliente"===g.rol&&g.empresa_id?Number(g.empresa_id):null};await t.Z.post("/api/admin/usuarios",e,{headers:{Authorization:"Bearer ".concat(o)}})}let e=await t.Z.get("/api/admin/usuarios",{headers:{Authorization:"Bearer ".concat(o)}});r(e.data.usuarios),h(!1)}catch(e){var i,a;c((null===(a=e.response)||void 0===a?void 0:null===(i=a.data)||void 0===i?void 0:i.error)||"Error al guardar usuario")}finally{u(!1)}};return(0,i.jsxs)("div",{children:[(0,i.jsx)(n.Z,{}),(0,i.jsxs)("div",{style:{padding:"2rem",fontFamily:"sans-serif"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[(0,i.jsx)("h1",{children:"Gesti\xf3n de Usuarios"}),(0,i.jsx)("button",{onClick:()=>{x(null),j({email:"",password:"",nombre_completo:"",rol:"cliente",empresa_id:""}),h(!0)},style:{padding:"0.5rem 1rem",backgroundColor:"#10b981",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Crear Usuario"})]}),d&&(0,i.jsx)("p",{style:{color:"red",marginBottom:"1rem"},children:d}),(0,i.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",border:"1px solid #ccc"},children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:"ID"}),(0,i.jsx)("th",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:"Email"}),(0,i.jsx)("th",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:"Nombre"}),(0,i.jsx)("th",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:"Rol"}),(0,i.jsx)("th",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:"Empresa"}),(0,i.jsx)("th",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:"Activo"}),(0,i.jsx)("th",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:"Acciones"})]})}),(0,i.jsx)("tbody",{children:e.map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:e.id}),(0,i.jsx)("td",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:e.email}),(0,i.jsx)("td",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:e.nombre_completo}),(0,i.jsx)("td",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:e.rol}),(0,i.jsx)("td",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:e.empresa_id||"—"}),(0,i.jsx)("td",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:e.activo?"✅":"❌"}),(0,i.jsxs)("td",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:[(0,i.jsx)("button",{onClick:()=>v(e),style:{marginRight:"0.5rem",padding:"0.25rem 0.5rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Editar"}),e.activo?(0,i.jsx)("button",{onClick:()=>C(e.id),style:{padding:"0.25rem 0.5rem",backgroundColor:"#ef4444",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Desactivar"}):null]})]},e.id))})]}),p&&(0,i.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,i.jsxs)("div",{style:{backgroundColor:"white",padding:"2rem",borderRadius:"8px",width:"500px",maxHeight:"80vh",overflowY:"auto"},children:[(0,i.jsx)("h2",{children:b?"Editar Usuario":"Crear Usuario"}),(0,i.jsxs)("form",{onSubmit:w,children:[(0,i.jsx)("div",{style:{marginBottom:"1rem"},children:(0,i.jsxs)("label",{children:["Email: ",(0,i.jsx)("input",{name:"email",value:g.email,onChange:f,required:!0,style:{width:"100%",padding:"0.5rem",marginTop:"0.25rem"}})]})}),!b&&(0,i.jsx)("div",{style:{marginBottom:"1rem"},children:(0,i.jsxs)("label",{children:["Contrase\xf1a: ",(0,i.jsx)("input",{name:"password",type:"password",value:g.password,onChange:f,required:!0,style:{width:"100%",padding:"0.5rem",marginTop:"0.25rem"}})]})}),(0,i.jsx)("div",{style:{marginBottom:"1rem"},children:(0,i.jsxs)("label",{children:["Nombre completo: ",(0,i.jsx)("input",{name:"nombre_completo",value:g.nombre_completo,onChange:f,required:!0,style:{width:"100%",padding:"0.5rem",marginTop:"0.25rem"}})]})}),(0,i.jsx)("div",{style:{marginBottom:"1rem"},children:(0,i.jsxs)("label",{children:["Rol:",(0,i.jsxs)("select",{name:"rol",value:g.rol,onChange:f,style:{width:"100%",padding:"0.5rem",marginTop:"0.25rem"},children:[(0,i.jsx)("option",{value:"admin",children:"Administrador"}),(0,i.jsx)("option",{value:"consultor",children:"Consultor"}),(0,i.jsx)("option",{value:"cliente",children:"Cliente"})]})]})}),"cliente"===g.rol&&(0,i.jsx)("div",{style:{marginBottom:"1rem"},children:(0,i.jsxs)("label",{children:["Empresa:",(0,i.jsxs)("select",{name:"empresa_id",value:g.empresa_id,onChange:f,required:!0,style:{width:"100%",padding:"0.5rem",marginTop:"0.25rem"},children:[(0,i.jsx)("option",{value:"",children:"Seleccionar..."}),o.map(e=>(0,i.jsx)("option",{value:e.id,children:e.nombre_legal},e.id))]})]})}),(0,i.jsxs)("div",{style:{display:"flex",gap:"1rem"},children:[(0,i.jsx)("button",{type:"submit",disabled:m,style:{padding:"0.5rem 1rem",backgroundColor:"#10b981",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:m?"Guardando...":b?"Actualizar":"Crear"}),(0,i.jsx)("button",{type:"button",onClick:()=>h(!1),style:{padding:"0.5rem 1rem",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Cancelar"})]})]})]})})]})]})}},1163:function(e,r,o){e.exports=o(9090)}},function(e){e.O(0,[66,888,774,179],function(){return e(e.s=2811)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[740],{142:function(e,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/empresas",function(){return n(6187)}])},5376:function(e,r,n){"use strict";n.d(r,{Z:function(){return l}});var t=n(5893),a=n(1163),o=n(7294);function l(){let[e,r]=(0,o.useState)(null),n=(0,a.useRouter)();if((0,o.useEffect)(()=>{let e=localStorage.getItem("user");e?r(JSON.parse(e)):n.push("/login")},[n]),!e)return null;let l=[];return"admin"===e.role?l.push({label:"Dashboard",href:"/dashboard"},{label:"Gesti\xf3n de Usuarios",href:"/admin/usuarios"},{label:"Gesti\xf3n de Empresas",href:"/admin/empresas"},{label:"Barridos",href:"/admin/barridos"},{label:"Matrices de Riesgo",href:"/admin/matrices"}):"consultor"===e.role?l.push({label:"Dashboard",href:"/dashboard"},{label:"Empresas",href:"/consultor/empresas"},{label:"Alertas",href:"/consultor/alertas"},{label:"Reportes",href:"/consultor/reportes"}):"cliente"===e.role&&l.push({label:"Dashboard",href:"/dashboard"},{label:"Mis Clientes",href:"/cliente/clientes"},{label:"Transacciones",href:"/cliente/transacciones"},{label:"Reportes",href:"/cliente/reportes"}),(0,t.jsxs)("nav",{style:{backgroundColor:"#1e40af",padding:"1rem",color:"white",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,t.jsx)("div",{children:(0,t.jsx)("h2",{style:{margin:0,fontSize:"1.2rem"},children:"admin"===e.role?"Consola Administrativa":"consultor"===e.role?"Panel Consultor":"Portal Cliente"})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{style:{marginBottom:"0.5rem",fontSize:"0.9rem"},children:[e.email," (",e.role,")"]}),(0,t.jsxs)("div",{style:{display:"flex",gap:"1rem"},children:[l.map(e=>(0,t.jsx)("button",{onClick:()=>n.push(e.href),style:{color:"white",background:"none",border:"none",cursor:"pointer",textDecoration:n.pathname===e.href?"underline":"none"},children:e.label},e.href)),(0,t.jsx)("button",{onClick:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),n.push("/login")},style:{color:"#f87171",background:"none",border:"none",cursor:"pointer"},children:"Cerrar Sesi\xf3n"})]})]})]})}},6187:function(e,r,n){"use strict";n.r(r),n.d(r,{default:function(){return s}});var t=n(5893),a=n(7294),o=n(1163),l=n(7066),i=n(5376);function s(){let[e,r]=(0,a.useState)([]),[n,s]=(0,a.useState)(""),[d,c]=(0,a.useState)(!1),[p,m]=(0,a.useState)(!1),[h,u]=(0,a.useState)(null),[b,g]=(0,a.useState)({nombre_legal:"",rfc:"",tipo_entidad:"persona_moral"}),x=(0,o.useRouter)();(0,a.useEffect)(()=>{let e=localStorage.getItem("token"),n=JSON.parse(localStorage.getItem("user")||"{}");if(!e||"admin"!==n.role){x.push("/login");return}(async()=>{try{let n=await l.Z.get("/api/admin/empresas",{headers:{Authorization:"Bearer ".concat(e)}});r(n.data.empresas)}catch(e){var n,t;s((null===(t=e.response)||void 0===t?void 0:null===(n=t.data)||void 0===n?void 0:n.error)||"Error al cargar empresas")}})()},[x]);let f=e=>{let{name:r,value:n}=e.target;g(e=>({...e,[r]:n}))},j=e=>{u(e.id),g({nombre_legal:e.nombre_legal,rfc:e.rfc||"",tipo_entidad:e.tipo_entidad}),m(!0)},y=async e=>{e.preventDefault();let n=localStorage.getItem("token");c(!0),s("");try{h?await l.Z.put("/api/admin/empresas/".concat(h),b,{headers:{Authorization:"Bearer ".concat(n)}}):await l.Z.post("/api/admin/empresas",b,{headers:{Authorization:"Bearer ".concat(n)}});let e=await l.Z.get("/api/admin/empresas",{headers:{Authorization:"Bearer ".concat(n)}});r(e.data.empresas),m(!1)}catch(e){var t,a;s((null===(a=e.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.error)||"Error al guardar empresa")}finally{c(!1)}};return(0,t.jsxs)("div",{children:[(0,t.jsx)(i.Z,{}),(0,t.jsxs)("div",{style:{padding:"2rem",fontFamily:"sans-serif"},children:[(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[(0,t.jsx)("h1",{children:"Gesti\xf3n de Empresas"}),(0,t.jsx)("button",{onClick:()=>{u(null),g({nombre_legal:"",rfc:"",tipo_entidad:"persona_moral"}),m(!0)},style:{padding:"0.5rem 1rem",backgroundColor:"#10b981",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Crear Empresa"})]}),n&&(0,t.jsx)("p",{style:{color:"red",marginBottom:"1rem"},children:n}),(0,t.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",border:"1px solid #ccc"},children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:"ID"}),(0,t.jsx)("th",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:"Nombre Legal"}),(0,t.jsx)("th",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:"RFC"}),(0,t.jsx)("th",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:"Tipo"}),(0,t.jsx)("th",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:"Acciones"})]})}),(0,t.jsx)("tbody",{children:e.map(e=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:e.id}),(0,t.jsx)("td",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:e.nombre_legal}),(0,t.jsx)("td",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:e.rfc||"â€”"}),(0,t.jsx)("td",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:e.tipo_entidad}),(0,t.jsx)("td",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:(0,t.jsx)("button",{onClick:()=>j(e),style:{padding:"0.25rem 0.5rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Editar"})})]},e.id))})]}),p&&(0,t.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,t.jsxs)("div",{style:{backgroundColor:"white",padding:"2rem",borderRadius:"8px",width:"500px"},children:[(0,t.jsx)("h2",{children:h?"Editar Empresa":"Crear Empresa"}),(0,t.jsxs)("form",{onSubmit:y,children:[(0,t.jsx)("div",{style:{marginBottom:"1rem"},children:(0,t.jsxs)("label",{children:["Nombre Legal: ",(0,t.jsx)("input",{name:"nombre_legal",value:b.nombre_legal,onChange:f,required:!0,style:{width:"100%",padding:"0.5rem",marginTop:"0.25rem"}})]})}),(0,t.jsx)("div",{style:{marginBottom:"1rem"},children:(0,t.jsxs)("label",{children:["RFC: ",(0,t.jsx)("input",{name:"rfc",value:b.rfc,onChange:f,style:{width:"100%",padding:"0.5rem",marginTop:"0.25rem"}})]})}),(0,t.jsx)("div",{style:{marginBottom:"1rem"},children:(0,t.jsxs)("label",{children:["Tipo de Entidad:",(0,t.jsxs)("select",{name:"tipo_entidad",value:b.tipo_entidad,onChange:f,style:{width:"100%",padding:"0.5rem",marginTop:"0.25rem"},children:[(0,t.jsx)("option",{value:"persona_fisica",children:"Persona F\xedsica"}),(0,t.jsx)("option",{value:"persona_moral",children:"Persona Moral"})]})]})}),(0,t.jsxs)("div",{style:{display:"flex",gap:"1rem"},children:[(0,t.jsx)("button",{type:"submit",disabled:d,style:{padding:"0.5rem 1rem",backgroundColor:"#10b981",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:d?"Guardando...":h?"Actualizar":"Crear"}),(0,t.jsx)("button",{type:"button",onClick:()=>m(!1),style:{padding:"0.5rem 1rem",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Cancelar"})]})]})]})})]})]})}},1163:function(e,r,n){e.exports=n(9090)}},function(e){e.O(0,[66,888,774,179],function(){return e(e.s=142)}),_N_E=e.O()}]);
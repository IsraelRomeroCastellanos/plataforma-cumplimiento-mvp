(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[360],{9823:function(e,r,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/cliente/clientes",function(){return i(2689)}])},5376:function(e,r,i){"use strict";i.d(r,{Z:function(){return o}});var a=i(5893),n=i(1163),t=i(7294);function o(){let[e,r]=(0,t.useState)(null),i=(0,n.useRouter)();if((0,t.useEffect)(()=>{let e=localStorage.getItem("user");e?r(JSON.parse(e)):i.push("/login")},[i]),!e)return null;let o=[];return"admin"===e.role?o.push({label:"Dashboard",href:"/dashboard"},{label:"Gesti\xf3n de Usuarios",href:"/admin/usuarios"},{label:"Gesti\xf3n de Empresas",href:"/admin/empresas"},{label:"Mis Clientes",href:"/cliente/clientes"},{label:"Carga Masiva",href:"/cliente/carga-masiva"},{label:"Barridos",href:"/admin/barridos"},{label:"Matrices de Riesgo",href:"/admin/matrices"},{label:"Cambiar Contrase\xf1a",href:"/cambiar-contrasena"}):"consultor"===e.role?o.push({label:"Dashboard",href:"/dashboard"},{label:"Empresas",href:"/consultor/empresas"},{label:"Mis Clientes",href:"/cliente/clientes"},{label:"Carga Masiva",href:"/cliente/carga-masiva"},{label:"Alertas",href:"/consultor/alertas"},{label:"Reportes",href:"/consultor/reportes"},{label:"Cambiar Contrase\xf1a",href:"/cambiar-contrasena"}):"cliente"===e.role&&o.push({label:"Dashboard",href:"/dashboard"},{label:"Mis Clientes",href:"/cliente/clientes"},{label:"Carga Masiva",href:"/cliente/carga-masiva"},{label:"Transacciones",href:"/cliente/transacciones"},{label:"Reportes",href:"/cliente/reportes"},{label:"Cambiar Contrase\xf1a",href:"/cambiar-contrasena"}),(0,a.jsxs)("nav",{style:{backgroundColor:"#1e40af",padding:"1rem",color:"white",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsx)("div",{children:(0,a.jsx)("h2",{style:{margin:0,fontSize:"1.2rem"},children:"admin"===e.role?"Consola Administrativa":"consultor"===e.role?"Panel Consultor":"Portal Cliente"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{style:{marginBottom:"0.5rem",fontSize:"0.9rem"},children:[e.email," (",e.role,")"]}),(0,a.jsxs)("div",{style:{display:"flex",gap:"1rem"},children:[o.map(e=>(0,a.jsx)("button",{onClick:()=>i.push(e.href),style:{color:"white",background:"none",border:"none",cursor:"pointer",textDecoration:i.pathname===e.href?"underline":"none"},children:e.label},e.href)),(0,a.jsx)("button",{onClick:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),i.push("/login")},style:{color:"#f87171",background:"none",border:"none",cursor:"pointer"},children:"Cerrar Sesi\xf3n"})]})]})]})}},2689:function(e,r,i){"use strict";i.r(r),i.d(r,{default:function(){return s}});var a=i(5893),n=i(7294),t=i(1163),o=i(7066),l=i(5376);function s(){let[e,r]=(0,n.useState)([]),[i,s]=(0,n.useState)(""),[d,c]=(0,n.useState)(!1),[m,h]=(0,n.useState)(!1),[p,u]=(0,n.useState)({nombre_entidad:"",tipo_cliente:"persona_fisica",actividad_economica:"",alias:"",fecha_nacimiento_constitucion:"",nacionalidad:"",domicilio_mexico:"",ocupacion:"",empresa_id:""}),g=(0,t.useRouter)(),[b,x]=(0,n.useState)(null);(0,n.useEffect)(()=>{{let e=localStorage.getItem("user");e&&x(JSON.parse(e).role)}},[]),(0,n.useEffect)(()=>{let e=localStorage.getItem("token"),i=localStorage.getItem("user"),a=i?JSON.parse(i):{};if(!e||!["admin","consultor","cliente"].includes(a.role)){g.push("/login");return}(async()=>{try{let i=await o.Z.get("/api/cliente/mis-clientes",{headers:{Authorization:"Bearer ".concat(e)}});r(i.data.clientes)}catch(e){var i,a;s((null===(a=e.response)||void 0===a?void 0:null===(i=a.data)||void 0===i?void 0:i.error)||"Error al cargar clientes")}})()},[g]);let v=e=>{let{name:r,value:i}=e.target;u(e=>({...e,[r]:i}))},f=async(e,i)=>{let a="activo"===i?"inactivo":"activo";if(!confirm("\xbfEst\xe1 seguro de ".concat("activo"===a?"activar":"desactivar"," este cliente?")))return;let n=localStorage.getItem("token");try{await o.Z.put("/api/cliente/".concat(e,"/estado"),{estado:a},{headers:{Authorization:"Bearer ".concat(n)}}),r(r=>r.map(r=>r.id===e?{...r,estado:a}:r))}catch(e){var t,l;s((null===(l=e.response)||void 0===l?void 0:null===(t=l.data)||void 0===t?void 0:t.error)||"Error al actualizar estado")}},j=async e=>{e.preventDefault();let i=localStorage.getItem("token");c(!0),s("");try{await o.Z.post("/api/cliente/registrar",p,{headers:{Authorization:"Bearer ".concat(i)}});let e=await o.Z.get("/api/cliente/mis-clientes",{headers:{Authorization:"Bearer ".concat(i)}});r(e.data.clientes),h(!1),u({nombre_entidad:"",tipo_cliente:"persona_fisica",actividad_economica:"",alias:"",fecha_nacimiento_constitucion:"",nacionalidad:"",domicilio_mexico:"",ocupacion:"",empresa_id:""})}catch(e){var a,n;s((null===(n=e.response)||void 0===n?void 0:null===(a=n.data)||void 0===a?void 0:a.error)||"Error al registrar cliente")}finally{c(!1)}};return(0,a.jsxs)("div",{children:[(0,a.jsx)(l.Z,{}),(0,a.jsxs)("div",{style:{padding:"2rem",fontFamily:"sans-serif"},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[(0,a.jsx)("h1",{children:"Mis Clientes"}),(0,a.jsxs)("div",{style:{display:"flex",gap:"0.5rem"},children:[(0,a.jsx)("button",{onClick:()=>{h(!0)},style:{padding:"0.5rem 1rem",backgroundColor:"#10b981",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Registrar Cliente"}),(0,a.jsx)("button",{onClick:()=>g.push("/cliente/carga-masiva"),style:{padding:"0.5rem 1rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Carga Masiva"})]})]}),i&&(0,a.jsx)("p",{style:{color:"red",marginBottom:"1rem"},children:i}),(0,a.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",border:"1px solid #ccc"},children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:"ID"}),(0,a.jsx)("th",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:"Nombre"}),(0,a.jsx)("th",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:"Tipo"}),(0,a.jsx)("th",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:"Actividad"}),b&&"cliente"!==b&&(0,a.jsx)("th",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:"Empresa"}),(0,a.jsx)("th",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:"Estado"}),(0,a.jsx)("th",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:"Acciones"})]})}),(0,a.jsx)("tbody",{children:e.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:e.id}),(0,a.jsx)("td",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:e.nombre_entidad}),(0,a.jsx)("td",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:e.tipo_cliente}),(0,a.jsx)("td",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:e.actividad_economica}),b&&"cliente"!==b&&(0,a.jsx)("td",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:e.empresa}),(0,a.jsx)("td",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:"activo"===e.estado?"✅":"❌"}),(0,a.jsx)("td",{style:{border:"1px solid #ccc",padding:"0.5rem"},children:(0,a.jsx)("button",{onClick:()=>f(e.id,e.estado),style:{padding:"0.25rem 0.5rem",backgroundColor:"activo"===e.estado?"#ef4444":"#10b981",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"activo"===e.estado?"Desactivar":"Activar"})})]},e.id))})]}),m&&(0,a.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,a.jsxs)("div",{style:{backgroundColor:"white",padding:"2rem",borderRadius:"8px",width:"500px",maxHeight:"80vh",overflowY:"auto"},children:[(0,a.jsx)("h2",{children:"Registrar Cliente"}),(0,a.jsxs)("form",{onSubmit:j,children:[(0,a.jsx)("div",{style:{marginBottom:"1rem"},children:(0,a.jsxs)("label",{children:["Nombre del Cliente: ",(0,a.jsx)("input",{name:"nombre_entidad",value:p.nombre_entidad,onChange:v,required:!0,style:{width:"100%",padding:"0.5rem",marginTop:"0.25rem"}})]})}),(0,a.jsx)("div",{style:{marginBottom:"1rem"},children:(0,a.jsxs)("label",{children:["Tipo de Cliente:",(0,a.jsxs)("select",{name:"tipo_cliente",value:p.tipo_cliente,onChange:v,style:{width:"100%",padding:"0.5rem",marginTop:"0.25rem"},children:[(0,a.jsx)("option",{value:"persona_fisica",children:"Persona F\xedsica"}),(0,a.jsx)("option",{value:"persona_moral",children:"Persona Moral"})]})]})}),(0,a.jsx)("div",{style:{marginBottom:"1rem"},children:(0,a.jsxs)("label",{children:["Actividad Econ\xf3mica: ",(0,a.jsx)("input",{name:"actividad_economica",value:p.actividad_economica,onChange:v,required:!0,style:{width:"100%",padding:"0.5rem",marginTop:"0.25rem"}})]})}),(0,a.jsx)("div",{style:{marginBottom:"1rem"},children:(0,a.jsxs)("label",{children:["Alias: ",(0,a.jsx)("input",{name:"alias",value:p.alias,onChange:v,style:{width:"100%",padding:"0.5rem",marginTop:"0.25rem"}})]})}),(0,a.jsx)("div",{style:{marginBottom:"1rem"},children:(0,a.jsxs)("label",{children:["Fecha Nacimiento/Constituci\xf3n: ",(0,a.jsx)("input",{name:"fecha_nacimiento_constitucion",type:"date",value:p.fecha_nacimiento_constitucion,onChange:v,style:{width:"100%",padding:"0.5rem",marginTop:"0.25rem"}})]})}),(0,a.jsx)("div",{style:{marginBottom:"1rem"},children:(0,a.jsxs)("label",{children:["Nacionalidad: ",(0,a.jsx)("input",{name:"nacionalidad",value:p.nacionalidad,onChange:v,style:{width:"100%",padding:"0.5rem",marginTop:"0.25rem"}})]})}),(0,a.jsx)("div",{style:{marginBottom:"1rem"},children:(0,a.jsxs)("label",{children:["Domicilio en M\xe9xico: ",(0,a.jsx)("input",{name:"domicilio_mexico",value:p.domicilio_mexico,onChange:v,style:{width:"100%",padding:"0.5rem",marginTop:"0.25rem"}})]})}),(0,a.jsx)("div",{style:{marginBottom:"1rem"},children:(0,a.jsxs)("label",{children:["Ocupaci\xf3n: ",(0,a.jsx)("input",{name:"ocupacion",value:p.ocupacion,onChange:v,style:{width:"100%",padding:"0.5rem",marginTop:"0.25rem"}})]})}),b&&"cliente"!==b&&(0,a.jsx)("div",{style:{marginBottom:"1rem"},children:(0,a.jsxs)("label",{children:["Empresa ID: ",(0,a.jsx)("input",{name:"empresa_id",value:p.empresa_id,onChange:v,required:!0,style:{width:"100%",padding:"0.5rem",marginTop:"0.25rem"}})]})}),(0,a.jsxs)("div",{style:{display:"flex",gap:"1rem"},children:[(0,a.jsx)("button",{type:"submit",disabled:d,style:{padding:"0.5rem 1rem",backgroundColor:"#10b981",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:d?"Guardando...":"Registrar"}),(0,a.jsx)("button",{type:"button",onClick:()=>h(!1),style:{padding:"0.5rem 1rem",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Cancelar"})]})]})]})})]})]})}},1163:function(e,r,i){e.exports=i(9090)}},function(e){e.O(0,[66,888,774,179],function(){return e(e.s=9823)}),_N_E=e.O()}]);
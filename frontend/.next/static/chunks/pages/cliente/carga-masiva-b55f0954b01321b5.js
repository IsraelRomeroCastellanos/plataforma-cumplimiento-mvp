(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[497],{9761:function(e,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/cliente/carga-masiva",function(){return n(5179)}])},5376:function(e,r,n){"use strict";n.d(r,{Z:function(){return a}});var i=n(5893),t=n(1163),l=n(7294);function a(){let[e,r]=(0,l.useState)(null),n=(0,t.useRouter)();if((0,l.useEffect)(()=>{let e=localStorage.getItem("user");e?r(JSON.parse(e)):n.push("/login")},[n]),!e)return null;let a=[];return"admin"===e.role?a.push({label:"Dashboard",href:"/dashboard"},{label:"Gesti\xf3n de Usuarios",href:"/admin/usuarios"},{label:"Gesti\xf3n de Empresas",href:"/admin/empresas"},{label:"Barridos",href:"/admin/barridos"},{label:"Matrices de Riesgo",href:"/admin/matrices"}):"consultor"===e.role?a.push({label:"Dashboard",href:"/dashboard"},{label:"Empresas",href:"/consultor/empresas"},{label:"Alertas",href:"/consultor/alertas"},{label:"Reportes",href:"/consultor/reportes"}):"cliente"===e.role&&a.push({label:"Dashboard",href:"/dashboard"},{label:"Mis Clientes",href:"/cliente/clientes"},{label:"Transacciones",href:"/cliente/transacciones"},{label:"Reportes",href:"/cliente/reportes"}),(0,i.jsxs)("nav",{style:{backgroundColor:"#1e40af",padding:"1rem",color:"white",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)("div",{children:(0,i.jsx)("h2",{style:{margin:0,fontSize:"1.2rem"},children:"admin"===e.role?"Consola Administrativa":"consultor"===e.role?"Panel Consultor":"Portal Cliente"})}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{marginBottom:"0.5rem",fontSize:"0.9rem"},children:[e.email," (",e.role,")"]}),(0,i.jsxs)("div",{style:{display:"flex",gap:"1rem"},children:[a.map(e=>(0,i.jsx)("button",{onClick:()=>n.push(e.href),style:{color:"white",background:"none",border:"none",cursor:"pointer",textDecoration:n.pathname===e.href?"underline":"none"},children:e.label},e.href)),(0,i.jsx)("button",{onClick:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),n.push("/login")},style:{color:"#f87171",background:"none",border:"none",cursor:"pointer"},children:"Cerrar Sesi\xf3n"})]})]})]})}},5179:function(e,r,n){"use strict";n.r(r),n.d(r,{default:function(){return o}});var i=n(5893),t=n(7294),l=n(1163),a=n(7066),s=n(5376);function o(){let[e,r]=(0,t.useState)(null),[n,o]=(0,t.useState)([]),[c,d]=(0,t.useState)(""),[u,h]=(0,t.useState)(""),[p,m]=(0,t.useState)(!1),f=(0,t.useRef)(null),b=(0,l.useRouter)(),x=async n=>{if(n.preventDefault(),!e){d("Selecciona un archivo CSV");return}let i=localStorage.getItem("token");if(!i){b.push("/login");return}m(!0),d(""),h("");let t=new FormData;t.append("file",e);try{let e=await a.Z.post("/api/cliente/carga-masiva",t,{headers:{Authorization:"Bearer ".concat(i),"Content-Type":"multipart/form-data"}});h("âœ… ".concat(e.data.successCount," clientes cargados exitosamente")),f.current&&(f.current.value=""),r(null),o([])}catch(e){var l,s;d((null===(s=e.response)||void 0===s?void 0:null===(l=s.data)||void 0===l?void 0:l.error)||"Error al cargar el archivo")}finally{m(!1)}};return(0,i.jsxs)("div",{children:[(0,i.jsx)(s.Z,{}),(0,i.jsxs)("div",{style:{padding:"2rem",fontFamily:"sans-serif"},children:[(0,i.jsx)("h1",{children:"Carga Masiva de Clientes"}),(0,i.jsx)("p",{children:"Sube un archivo CSV con la siguiente estructura:"}),(0,i.jsxs)("ul",{children:[(0,i.jsxs)("li",{children:[(0,i.jsx)("strong",{children:"Campos obligatorios"}),": nombre_entidad, tipo_cliente, actividad_economica"]}),(0,i.jsxs)("li",{children:[(0,i.jsx)("strong",{children:"Campos opcionales"}),": alias, fecha_nacimiento_constitucion, nacionalidad, domicilio_mexico, ocupacion"]}),(0,i.jsxs)("li",{children:[(0,i.jsx)("strong",{children:"Ejemplo"}),":",(0,i.jsx)("pre",{style:{backgroundColor:"#f1f1f1",padding:"0.5rem"},children:"nombre_entidad,tipo_cliente,actividad_economica,alias Juan P\xe9rez,persona_fisica,venta_de_inmuebles,JP"})]})]}),(0,i.jsxs)("form",{onSubmit:x,style:{marginTop:"1rem"},children:[(0,i.jsx)("div",{style:{marginBottom:"1rem"},children:(0,i.jsx)("input",{type:"file",accept:".csv",onChange:e=>{var n;let i=null===(n=e.target.files)||void 0===n?void 0:n[0];if(!i)return;if(!i.name.endsWith(".csv")){d("Por favor selecciona un archivo CSV");return}r(i),d(""),h("");let t=new FileReader;t.onload=e=>{var r;let n=(null===(r=e.target)||void 0===r?void 0:r.result).split("\n").filter(e=>""!==e.trim()),i=n[0].split(",").map(e=>e.trim()),t=["nombre_entidad","tipo_cliente","actividad_economica"].filter(e=>!i.includes(e));if(t.length>0){d("Faltan columnas requeridas: ".concat(t.join(", ")));return}o(n.slice(1).map(e=>{let r=e.split(","),n={};return i.forEach((e,i)=>{n[e]=r[i]?r[i].trim():""}),n}).slice(0,5))},t.readAsText(i)},ref:f})}),c&&(0,i.jsx)("p",{style:{color:"red"},children:c}),u&&(0,i.jsx)("p",{style:{color:"green"},children:u}),n.length>0&&(0,i.jsxs)("div",{style:{marginTop:"1rem"},children:[(0,i.jsx)("h3",{children:"Vista previa (primeras 5 filas):"}),(0,i.jsxs)("table",{style:{width:"100%",border:"1px solid #ccc",borderCollapse:"collapse"},children:[(0,i.jsx)("thead",{children:(0,i.jsx)("tr",{children:Object.keys(n[0]).map(e=>(0,i.jsx)("th",{style:{border:"1px solid #ccc",padding:"0.25rem"},children:e},e))})}),(0,i.jsx)("tbody",{children:n.map((e,r)=>(0,i.jsx)("tr",{children:Object.values(e).map((e,r)=>(0,i.jsx)("td",{style:{border:"1px solid #ccc",padding:"0.25rem"},children:e},r))},r))})]})]}),(0,i.jsx)("button",{type:"submit",disabled:p||!e,style:{padding:"0.5rem 1rem",backgroundColor:"#10b981",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:p?"Cargando...":"Subir Clientes"})]})]})]})}},1163:function(e,r,n){e.exports=n(9090)}},function(e){e.O(0,[66,888,774,179],function(){return e(e.s=9761)}),_N_E=e.O()}]);
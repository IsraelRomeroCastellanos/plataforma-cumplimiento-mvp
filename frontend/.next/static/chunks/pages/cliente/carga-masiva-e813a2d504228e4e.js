(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[497],{9761:function(e,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/cliente/carga-masiva",function(){return n(5179)}])},5376:function(e,r,n){"use strict";n.d(r,{Z:function(){return o}});var a=n(5893),i=n(1163),t=n(7294);function o(){let[e,r]=(0,t.useState)(null),n=(0,i.useRouter)();if((0,t.useEffect)(()=>{let e=localStorage.getItem("user");e?r(JSON.parse(e)):n.push("/login")},[n]),!e)return null;let o=[];return"admin"===e.role?o.push({label:"Dashboard",href:"/dashboard"},{label:"Gesti\xf3n de Usuarios",href:"/admin/usuarios"},{label:"Gesti\xf3n de Empresas",href:"/admin/empresas"},{label:"Mis Clientes",href:"/cliente/clientes"},{label:"Carga Masiva",href:"/cliente/carga-masiva"},{label:"Barridos",href:"/admin/barridos"},{label:"Matrices de Riesgo",href:"/admin/matrices"},{label:"Cambiar Contrase\xf1a",href:"/cambiar-contrasena"}):"consultor"===e.role?o.push({label:"Dashboard",href:"/dashboard"},{label:"Empresas",href:"/consultor/empresas"},{label:"Mis Clientes",href:"/cliente/clientes"},{label:"Carga Masiva",href:"/cliente/carga-masiva"},{label:"Alertas",href:"/consultor/alertas"},{label:"Reportes",href:"/consultor/reportes"},{label:"Cambiar Contrase\xf1a",href:"/cambiar-contrasena"}):"cliente"===e.role&&o.push({label:"Dashboard",href:"/dashboard"},{label:"Mis Clientes",href:"/cliente/clientes"},{label:"Carga Masiva",href:"/cliente/carga-masiva"},{label:"Transacciones",href:"/cliente/transacciones"},{label:"Reportes",href:"/cliente/reportes"},{label:"Cambiar Contrase\xf1a",href:"/cambiar-contrasena"}),(0,a.jsxs)("nav",{style:{backgroundColor:"#1e40af",padding:"1rem",color:"white",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsx)("div",{children:(0,a.jsx)("h2",{style:{margin:0,fontSize:"1.2rem"},children:"admin"===e.role?"Consola Administrativa":"consultor"===e.role?"Panel Consultor":"Portal Cliente"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{style:{marginBottom:"0.5rem",fontSize:"0.9rem"},children:[e.email," (",e.role,")"]}),(0,a.jsxs)("div",{style:{display:"flex",gap:"1rem"},children:[o.map(e=>(0,a.jsx)("button",{onClick:()=>n.push(e.href),style:{color:"white",background:"none",border:"none",cursor:"pointer",textDecoration:n.pathname===e.href?"underline":"none"},children:e.label},e.href)),(0,a.jsx)("button",{onClick:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),n.push("/login")},style:{color:"#f87171",background:"none",border:"none",cursor:"pointer"},children:"Cerrar Sesi\xf3n"})]})]})]})}},5179:function(e,r,n){"use strict";n.r(r),n.d(r,{default:function(){return s}});var a=n(5893),i=n(7294),t=n(1163),o=n(7066),l=n(5376);function s(){let[e,r]=(0,i.useState)(null),[n,s]=(0,i.useState)(""),[c,d]=(0,i.useState)([]),[u,h]=(0,i.useState)(""),[p,m]=(0,i.useState)(""),[b,f]=(0,i.useState)(!1),g=(0,t.useRouter)(),x=async e=>{e.preventDefault();let a=localStorage.getItem("token");if(!a){g.push("/login");return}if(!n){h("Selecciona un archivo CSV v\xe1lido");return}f(!0),h(""),m("");try{let e=await o.Z.post("/api/carga-directa",{csvContent:n},{headers:{Authorization:"Bearer ".concat(a)}});m("âœ… ".concat(e.data.message)),r(null),s(""),d([]),document.getElementById("fileInput").value=""}catch(e){var i,t;h((null===(t=e.response)||void 0===t?void 0:null===(i=t.data)||void 0===i?void 0:i.error)||"Error al procesar el archivo")}finally{f(!1)}};return(0,a.jsxs)("div",{children:[(0,a.jsx)(l.Z,{}),(0,a.jsxs)("div",{style:{padding:"2rem",fontFamily:"sans-serif"},children:[(0,a.jsx)("h1",{children:"Carga Masiva de Clientes"}),(0,a.jsx)("p",{children:"Sube un archivo CSV con la siguiente estructura:"}),(0,a.jsxs)("ul",{children:[(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Campos obligatorios"}),": nombre_entidad, tipo_cliente, actividad_economica"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Campos opcionales"}),": estado_bien, alias, fecha_nacimiento_constitucion, nacionalidad, domicilio_mexico, ocupacion"]})]}),(0,a.jsxs)("div",{style:{marginBottom:"1rem",display:"flex",gap:"0.5rem"},children:[(0,a.jsx)("button",{type:"button",onClick:()=>{let e=new Blob([new Uint8Array([239,187,191]),"nombre_entidad,tipo_cliente,actividad_economica,estado_bien,alias,fecha_nacimiento_constitucion,nacionalidad,domicilio_mexico,ocupacion\nJoyeros de M\xe9xico,persona_moral,venta_de_joyas,Nuevo,,15/05/1990,Mexicana,Ciudad de M\xe9xico,\nMar\xeda L\xf3pez,persona_fisica,servicios_profesionales,Usado,,23/11/1985,Argentina,Monterrey,\n# Reglas:\n# - tipo_cliente: persona_fisica o persona_moral\n# - estado_bien: Nuevo, Usado, Viejo\n# - fecha_nacimiento_constitucion: formato DD/MM/AAAA\n"],{type:"text/csv;charset=utf-8"}),r=URL.createObjectURL(e),n=document.createElement("a");n.setAttribute("href",r),n.setAttribute("download","plantilla_clientes.csv"),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)},style:{padding:"10px 16px",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px"},children:"\uD83D\uDCE5 Plantilla CSV"}),(0,a.jsx)("button",{type:"button",onClick:()=>{window.location.href="/api/cliente/plantilla-excel"},style:{padding:"10px 16px",backgroundColor:"#10b981",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px"},children:"\uD83D\uDCCA Plantilla Excel (.xlsx)"})]}),(0,a.jsxs)("form",{onSubmit:x,style:{marginTop:"1rem"},children:[(0,a.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,a.jsx)("label",{htmlFor:"fileInput",children:"Seleccionar archivo CSV:"}),(0,a.jsx)("input",{id:"fileInput",type:"file",accept:".csv",onChange:e=>{var n;let a=null===(n=e.target.files)||void 0===n?void 0:n[0];if(!a)return;if(!a.name.endsWith(".csv")){h("Por favor selecciona un archivo CSV");return}r(a),h(""),m("");let i=new FileReader;i.onload=e=>{var r;let n=(null===(r=e.target)||void 0===r?void 0:r.result).split("\n").filter(e=>!e.trim().startsWith("#"));n.length>0&&(n[0].includes("Nombre del Cliente *")||n[0].includes("nombre_entidad"))&&(n=n.slice(1)),s(n.join("\n")),d(n.slice(0,5))},i.readAsText(a,"utf-8")},style:{marginLeft:"0.5rem",width:"100%",maxWidth:"300px"}})]}),c.length>0&&(0,a.jsxs)("div",{style:{marginTop:"1rem",padding:"10px",backgroundColor:"#f9f9f9",borderRadius:"4px"},children:[(0,a.jsx)("strong",{children:"Vista previa (primeras 5 l\xedneas):"}),(0,a.jsx)("pre",{style:{margin:0,whiteSpace:"pre-wrap"},children:c.join("\n")})]}),u&&(0,a.jsx)("p",{style:{color:"red",marginTop:"1rem"},children:u}),p&&(0,a.jsx)("p",{style:{color:"green",marginTop:"1rem"},children:p}),(0,a.jsx)("button",{type:"submit",disabled:b||!n,style:{padding:"0.5rem 1rem",backgroundColor:"#10b981",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",marginTop:"1rem"},children:b?"Procesando...":"Subir Clientes"})]})]})]})}},1163:function(e,r,n){e.exports=n(9090)}},function(e){e.O(0,[66,888,774,179],function(){return e(e.s=9761)}),_N_E=e.O()}]);
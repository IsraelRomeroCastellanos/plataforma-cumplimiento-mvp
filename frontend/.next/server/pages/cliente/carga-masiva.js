"use strict";(()=>{var e={};e.id=497,e.ids=[497,660],e.modules={4993:(e,r,a)=>{a.a(e,async(e,t)=>{try{a.r(r),a.d(r,{config:()=>f,default:()=>m,getServerSideProps:()=>g,getStaticPaths:()=>b,getStaticProps:()=>h,reportWebVitals:()=>x,routeModule:()=>_,unstable_getServerProps:()=>y,unstable_getServerSideProps:()=>j,unstable_getStaticParams:()=>C,unstable_getStaticPaths:()=>S,unstable_getStaticProps:()=>v});var i=a(7093),n=a(5244),o=a(1323),l=a(2899),s=a.n(l),c=a(6958),d=a.n(c),u=a(5179),p=e([u]);u=(p.then?(await p)():p)[0];let m=(0,o.l)(u,"default"),h=(0,o.l)(u,"getStaticProps"),b=(0,o.l)(u,"getStaticPaths"),g=(0,o.l)(u,"getServerSideProps"),f=(0,o.l)(u,"config"),x=(0,o.l)(u,"reportWebVitals"),v=(0,o.l)(u,"unstable_getStaticProps"),S=(0,o.l)(u,"unstable_getStaticPaths"),C=(0,o.l)(u,"unstable_getStaticParams"),y=(0,o.l)(u,"unstable_getServerProps"),j=(0,o.l)(u,"unstable_getServerSideProps"),_=new i.PagesRouteModule({definition:{kind:n.x.PAGES,page:"/cliente/carga-masiva",pathname:"/cliente/carga-masiva",bundlePath:"",filename:""},components:{App:d(),Document:s()},userland:u});t()}catch(e){t(e)}})},5376:(e,r,a)=>{a.d(r,{Z:()=>o});var t=a(997),i=a(1163),n=a(6689);function o(){let[e,r]=(0,n.useState)(null),a=(0,i.useRouter)();if(!e)return null;let o=[];return"admin"===e.role?o.push({label:"Dashboard",href:"/dashboard"},{label:"Gesti\xf3n de Usuarios",href:"/admin/usuarios"},{label:"Gesti\xf3n de Empresas",href:"/admin/empresas"},{label:"Mis Clientes",href:"/cliente/clientes"},{label:"Carga Masiva",href:"/cliente/carga-masiva"},{label:"Barridos",href:"/admin/barridos"},{label:"Matrices de Riesgo",href:"/admin/matrices"},{label:"Cambiar Contrase\xf1a",href:"/cambiar-contrasena"}):"consultor"===e.role?o.push({label:"Dashboard",href:"/dashboard"},{label:"Empresas",href:"/consultor/empresas"},{label:"Mis Clientes",href:"/cliente/clientes"},{label:"Carga Masiva",href:"/cliente/carga-masiva"},{label:"Alertas",href:"/consultor/alertas"},{label:"Reportes",href:"/consultor/reportes"},{label:"Cambiar Contrase\xf1a",href:"/cambiar-contrasena"}):"cliente"===e.role&&o.push({label:"Dashboard",href:"/dashboard"},{label:"Mis Clientes",href:"/cliente/clientes"},{label:"Carga Masiva",href:"/cliente/carga-masiva"},{label:"Transacciones",href:"/cliente/transacciones"},{label:"Reportes",href:"/cliente/reportes"},{label:"Cambiar Contrase\xf1a",href:"/cambiar-contrasena"}),(0,t.jsxs)("nav",{style:{backgroundColor:"#1e40af",padding:"1rem",color:"white",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("div",{children:t.jsx("h2",{style:{margin:0,fontSize:"1.2rem"},children:"admin"===e.role?"Consola Administrativa":"consultor"===e.role?"Panel Consultor":"Portal Cliente"})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{style:{marginBottom:"0.5rem",fontSize:"0.9rem"},children:[e.email," (",e.role,")"]}),(0,t.jsxs)("div",{style:{display:"flex",gap:"1rem"},children:[o.map(e=>t.jsx("button",{onClick:()=>a.push(e.href),style:{color:"white",background:"none",border:"none",cursor:"pointer",textDecoration:a.pathname===e.href?"underline":"none"},children:e.label},e.href)),t.jsx("button",{onClick:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),a.push("/login")},style:{color:"#f87171",background:"none",border:"none",cursor:"pointer"},children:"Cerrar Sesi\xf3n"})]})]})]})}},5179:(e,r,a)=>{a.a(e,async(e,t)=>{try{a.r(r),a.d(r,{default:()=>d});var i=a(997),n=a(6689),o=a(1163),l=a(9648),s=a(5376),c=e([l]);function d(){let[e,r]=(0,n.useState)(null),[a,t]=(0,n.useState)(""),[c,d]=(0,n.useState)([]),[u,p]=(0,n.useState)(""),[m,h]=(0,n.useState)(""),[b,g]=(0,n.useState)(!1),f=(0,o.useRouter)(),x=async e=>{e.preventDefault();let i=localStorage.getItem("token");if(!i){f.push("/login");return}if(!a){p("Selecciona un archivo CSV v\xe1lido");return}g(!0),p(""),h("");try{let e=await l.default.post("/api/carga-directa",{csvContent:a},{headers:{Authorization:`Bearer ${i}`}});h(`âœ… ${e.data.message}`),r(null),t(""),d([]),document.getElementById("fileInput").value=""}catch(e){p(e.response?.data?.error||"Error al procesar el archivo")}finally{g(!1)}};return(0,i.jsxs)("div",{children:[i.jsx(s.Z,{}),(0,i.jsxs)("div",{style:{padding:"2rem",fontFamily:"sans-serif"},children:[i.jsx("h1",{children:"Carga Masiva de Clientes"}),i.jsx("p",{children:"Sube un archivo CSV con la siguiente estructura:"}),(0,i.jsxs)("ul",{children:[(0,i.jsxs)("li",{children:[i.jsx("strong",{children:"Campos obligatorios"}),": nombre_entidad, tipo_cliente, actividad_economica"]}),(0,i.jsxs)("li",{children:[i.jsx("strong",{children:"Campos opcionales"}),": estado_bien, alias, fecha_nacimiento_constitucion, nacionalidad, domicilio_mexico, ocupacion"]})]}),(0,i.jsxs)("div",{style:{marginBottom:"1rem",display:"flex",gap:"0.5rem"},children:[i.jsx("button",{type:"button",onClick:()=>{let e=`nombre_entidad,tipo_cliente,actividad_economica,estado_bien,alias,fecha_nacimiento_constitucion,nacionalidad,domicilio_mexico,ocupacion
Joyeros de M\xe9xico,persona_moral,venta_de_joyas,Nuevo,,15/05/1990,Mexicana,Ciudad de M\xe9xico,
Mar\xeda L\xf3pez,persona_fisica,servicios_profesionales,Usado,,23/11/1985,Argentina,Monterrey,
# Reglas:
# - tipo_cliente: persona_fisica o persona_moral
# - estado_bien: Nuevo, Usado, Viejo
# - fecha_nacimiento_constitucion: formato DD/MM/AAAA
`,r=new Uint8Array([239,187,191]),a=new Blob([r,e],{type:"text/csv;charset=utf-8"}),t=URL.createObjectURL(a),i=document.createElement("a");i.setAttribute("href",t),i.setAttribute("download","plantilla_clientes.csv"),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)},style:{padding:"10px 16px",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px"},children:"\uD83D\uDCE5 Plantilla CSV"}),i.jsx("button",{type:"button",onClick:()=>{window.location.href="/api/cliente/plantilla-excel"},style:{padding:"10px 16px",backgroundColor:"#10b981",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px"},children:"\uD83D\uDCCA Plantilla Excel (.xlsx)"})]}),(0,i.jsxs)("form",{onSubmit:x,style:{marginTop:"1rem"},children:[(0,i.jsxs)("div",{style:{marginBottom:"1rem"},children:[i.jsx("label",{htmlFor:"fileInput",children:"Seleccionar archivo CSV:"}),i.jsx("input",{id:"fileInput",type:"file",accept:".csv",onChange:e=>{let a=e.target.files?.[0];if(!a)return;if(!a.name.endsWith(".csv")){p("Por favor selecciona un archivo CSV");return}r(a),p(""),h("");let i=new FileReader;i.onload=e=>{let r=(e.target?.result).split("\n").filter(e=>!e.trim().startsWith("#"));r.length>0&&(r[0].includes("Nombre del Cliente *")||r[0].includes("nombre_entidad"))&&(r=r.slice(1)),t(r.join("\n")),d(r.slice(0,5))},i.readAsText(a,"utf-8")},style:{marginLeft:"0.5rem",width:"100%",maxWidth:"300px"}})]}),c.length>0&&(0,i.jsxs)("div",{style:{marginTop:"1rem",padding:"10px",backgroundColor:"#f9f9f9",borderRadius:"4px"},children:[i.jsx("strong",{children:"Vista previa (primeras 5 l\xedneas):"}),i.jsx("pre",{style:{margin:0,whiteSpace:"pre-wrap"},children:c.join("\n")})]}),u&&i.jsx("p",{style:{color:"red",marginTop:"1rem"},children:u}),m&&i.jsx("p",{style:{color:"green",marginTop:"1rem"},children:m}),i.jsx("button",{type:"submit",disabled:b||!a,style:{padding:"0.5rem 1rem",backgroundColor:"#10b981",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",marginTop:"1rem"},children:b?"Procesando...":"Subir Clientes"})]})]})]})}l=(c.then?(await c)():c)[0],t()}catch(e){t(e)}})},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},6162:e=>{e.exports=require("stream")},1568:e=>{e.exports=require("zlib")},9648:e=>{e.exports=import("axios")}};var r=require("../../webpack-runtime.js");r.C(e);var a=e=>r(r.s=e),t=r.X(0,[899,125],()=>a(4993));module.exports=t})();